# Prompt Templates for Invoice/Receipt Processing

default_invoice:
  name: "Invoice Extraction"
  description: "Extract standard invoice/receipt fields"
  system_prompt: |
    You are an expert at analyzing invoices and receipts.
    Extract information accurately and return valid JSON only.
    If a field is not found, use null as the value.

  user_prompt: |
    Analyze this invoice/receipt image and extract the following information:

    Required fields:
    - invoice_number: The invoice or receipt number
    - invoice_date: The date of the invoice/receipt (format: YYYY-MM-DD)
    - payment_date: The date payment was made (format: YYYY-MM-DD), if available
    - service_date: The date when services were performed (format: YYYY-MM-DD), if available
    - service_provider: The name of the company/person providing the service
    - buyer: The name of the buyer/customer (if not specified, try to identify from the document)
    - amount: The total amount paid (numeric value only)
    - currency: The currency code (e.g., USD, EUR, GBP)
    - description: Brief description of services/products
    - payment_method: Method of payment - must be one of: "creditcard", "banktransfer", "cash", "other", or "N/A" if not mentioned or cannot be determined
    - paymentBankAccountNumber: (ONLY if payment_method is "banktransfer") The bank account number where payment should be sent
    - paymentReference: (ONLY if payment_method is "banktransfer") The payment reference or note to include with the bank transfer

    {buyer_context}

    Return ONLY a valid JSON object with these fields. Do not include any other text or markdown formatting.

    IMPORTANT RULES for payment_method "banktransfer":
    1. paymentBankAccountNumber: Extract the account number and REMOVE all spaces, dashes, and special characters. Keep only letters and numbers.
    2. paymentReference: Extract the exact reference text that should be used in the bank transfer. Look for labels like "Payment Communication:", "Reference:", "Payment Reference:", "Structured Communication:", etc.

    POSITIVE EXAMPLES (correct extraction):

    Example 1 - Basic bank transfer:
    Input text: "Payment Communication: INV/2025/01579 on this account: BE07 9050 4713 8266 - Wise EUR"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE07905047138266",
      "paymentReference": "INV/2025/01579"
    }}

    Example 2 - Structured reference:
    Input text: "Please transfer to IBAN: DE89 3704 0044 0532 0130 00 with reference: Invoice-2024-ABC-123"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "Invoice-2024-ABC-123"
    }}

    Example 3 - Payment reference with special format:
    Input text: "Account: GB29 NWBK 6016 1331 9268 19, Payment note: REF-2025/Q1/789"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "GB29NWBK60161331926819",
      "paymentReference": "REF-2025/Q1/789"
    }}

    Example 4 - Multiple reference formats:
    Input text: "Structured communication: +++123/4567/89012+++ Bank: BE71 0961 2345 6769"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE71096123456769",
      "paymentReference": "+++123/4567/89012+++"
    }}

    NEGATIVE EXAMPLES (what NOT to do):

    ❌ WRONG - Don't keep spaces in account numbers:
    {{
      "paymentBankAccountNumber": "BE07 9050 4713 8266"  // WRONG! Remove spaces
    }}

    ❌ WRONG - Don't use invoice number as payment reference unless explicitly stated:
    {{
      "invoice_number": "INV-2024-001",
      "paymentReference": "INV-2024-001"  // WRONG if document says "Use payment ref: ORDER-123"
    }}

    ❌ WRONG - Don't extract bank name as part of account number:
    {{
      "paymentBankAccountNumber": "BE07905047138266-Wise"  // WRONG! Remove bank name
    }}

    ❌ WRONG - Don't include labels in the reference:
    {{
      "paymentReference": "Payment Communication: INV/2025/01579"  // WRONG! Remove label
    }}

    Standard example format:
    {{
      "invoice_number": "INV-2024-001",
      "invoice_date": "2024-01-15",
      "payment_date": "2024-01-20",
      "service_date": "2024-01-10",
      "service_provider": "ABC Services Inc.",
      "buyer": "XYZ Company",
      "amount": 1500.00,
      "currency": "USD",
      "description": "Consulting services",
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "INV-2024-001"
    }}

detailed_invoice:
  name: "Detailed Invoice Extraction"
  description: "Extract detailed invoice fields including line items"
  system_prompt: |
    You are an expert at analyzing invoices and receipts with attention to detail.
    Extract all information accurately and return valid JSON only.
    If a field is not found, use null as the value.

  user_prompt: |
    Analyze this invoice/receipt image and extract the following information:

    Required fields:
    - invoice_number: The invoice or receipt number
    - invoice_date: The date of the invoice/receipt (format: YYYY-MM-DD)
    - due_date: The payment due date (format: YYYY-MM-DD), if available
    - payment_date: The date payment was made (format: YYYY-MM-DD), if available
    - service_date: The date when services were performed (format: YYYY-MM-DD), if available
    - service_provider: Object with name, address, tax_id, contact details
    - buyer: Object with name, address, contact details (if not specified in context, extract from document)
    - line_items: Array of items/services with description, quantity, unit_price (net price per unit WITHOUT VAT/TAX), total (net total for this line WITHOUT VAT/TAX), tax_rate (tax rate percentage for this line item, if specified on the invoice)
    - subtotal: Subtotal amount before taxes (sum of all line item totals)
    - tax_amount: Tax amount
    - tax_rate: Overall tax rate percentage (if uniform across all items)
    - total_amount: The total amount including taxes (subtotal + tax_amount)

    IMPORTANT: Each line item should have its tax_rate if specified on the invoice. Some invoices have different tax rates for different items (e.g., 20% for services, 0% for exports).
    - currency: The currency code (e.g., USD, EUR, GBP)
    - payment_method: Method of payment - must be one of: "creditcard", "banktransfer", "cash", "other", or "N/A" if not mentioned or cannot be determined
    - paymentBankAccountNumber: (ONLY if payment_method is "banktransfer") The bank account number where payment should be sent
    - paymentReference: (ONLY if payment_method is "banktransfer") The payment reference or note to include with the bank transfer
    - notes: Any additional notes or terms

    {buyer_context}

    Return ONLY a valid JSON object. Do not include any markdown formatting or extra text.

    IMPORTANT RULES for payment_method "banktransfer":
    1. paymentBankAccountNumber: Extract the account number and REMOVE all spaces, dashes, and special characters. Keep only letters and numbers.
    2. paymentReference: Extract the exact reference text that should be used in the bank transfer. Look for labels like "Payment Communication:", "Reference:", "Payment Reference:", "Structured Communication:", etc.

    POSITIVE EXAMPLES (correct extraction):

    Example 1 - Basic bank transfer:
    Input text: "Payment Communication: INV/2025/01579 on this account: BE07 9050 4713 8266 - Wise EUR"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE07905047138266",
      "paymentReference": "INV/2025/01579"
    }}

    Example 2 - Structured reference:
    Input text: "Please transfer to IBAN: DE89 3704 0044 0532 0130 00 with reference: Invoice-2024-ABC-123"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "Invoice-2024-ABC-123"
    }}

    Example 3 - Payment reference with special format:
    Input text: "Account: GB29 NWBK 6016 1331 9268 19, Payment note: REF-2025/Q1/789"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "GB29NWBK60161331926819",
      "paymentReference": "REF-2025/Q1/789"
    }}

    NEGATIVE EXAMPLES (what NOT to do):

    ❌ WRONG - Don't keep spaces in account numbers:
    {{
      "paymentBankAccountNumber": "BE07 9050 4713 8266"  // WRONG! Remove spaces
    }}

    ❌ WRONG - Don't use invoice number as payment reference unless explicitly stated:
    {{
      "invoice_number": "INV-2024-001",
      "paymentReference": "INV-2024-001"  // WRONG if document says "Use payment ref: ORDER-123"
    }}

    ❌ WRONG - Don't extract bank name as part of account number:
    {{
      "paymentBankAccountNumber": "BE07905047138266-Wise"  // WRONG! Remove bank name
    }}

    ❌ WRONG - Don't include labels in the reference:
    {{
      "paymentReference": "Payment Communication: INV/2025/01579"  // WRONG! Remove label
    }}

    Example with line items (IMPORTANT - unit_price and total are NET amounts WITHOUT VAT):
    {{
      "invoice_number": "INV-2025-001",
      "invoice_date": "2025-01-15",
      "service_provider": {{
        "name": "ABC Consulting Ltd",
        "address": "123 Business St, New York, NY 10001",
        "tax_id": "12-3456789"
      }},
      "buyer": {{
        "name": "XYZ Corporation",
        "address": "456 Commerce Ave, Boston, MA 02101"
      }},
      "line_items": [
        {{
          "description": "Consulting services - January",
          "quantity": 40,
          "unit_price": 100.00,
          "total": 4000.00,
          "tax_rate": 20.0
        }},
        {{
          "description": "Software license",
          "quantity": 1,
          "unit_price": 500.00,
          "total": 500.00,
          "tax_rate": 20.0
        }}
      ],
      "subtotal": 4500.00,
      "tax_rate": 20.0,
      "tax_amount": 900.00,
      "total_amount": 5400.00,
      "currency": "USD",
      "payment_method": "banktransfer"
    }}

    Example with different tax rates per line item:
    {{
      "invoice_number": "INV-2025-002",
      "invoice_date": "2025-01-20",
      "line_items": [
        {{
          "description": "Consulting services (Standard rate)",
          "quantity": 10,
          "unit_price": 150.00,
          "total": 1500.00,
          "tax_rate": 20.0
        }},
        {{
          "description": "Books (Reduced rate)",
          "quantity": 5,
          "unit_price": 25.00,
          "total": 125.00,
          "tax_rate": 5.0
        }},
        {{
          "description": "Export service (Zero rate)",
          "quantity": 1,
          "unit_price": 500.00,
          "total": 500.00,
          "tax_rate": 0.0
        }}
      ],
      "subtotal": 2125.00,
      "tax_amount": 306.25,
      "total_amount": 2431.25,
      "currency": "EUR"
    }}

simple_receipt:
  name: "Simple Receipt Extraction"
  description: "Extract basic receipt information"
  system_prompt: |
    You are an expert at analyzing receipts.
    Extract information accurately and return valid JSON only.

  user_prompt: |
    Analyze this receipt image and extract:

    - receipt_number: Receipt number or transaction ID
    - date: Date of purchase (format: YYYY-MM-DD)
    - merchant: Name of the merchant/store
    - amount: Total amount
    - currency: Currency code
    - items: Brief description of purchased items
    - payment_method: Method of payment - must be one of: "creditcard", "banktransfer", "cash", "other", or "N/A" if not mentioned or cannot be determined
    - paymentBankAccountNumber: (ONLY if payment_method is "banktransfer") The bank account number where payment should be sent
    - paymentReference: (ONLY if payment_method is "banktransfer") The payment reference or note to include with the bank transfer

    {buyer_context}

    Return ONLY a valid JSON object with these fields.

    IMPORTANT RULES for payment_method "banktransfer":
    1. paymentBankAccountNumber: Extract the account number and REMOVE all spaces, dashes, and special characters. Keep only letters and numbers.
    2. paymentReference: Extract the exact reference text that should be used in the bank transfer. Look for labels like "Payment Communication:", "Reference:", "Payment Reference:", "Structured Communication:", etc.

    POSITIVE EXAMPLES (correct extraction):

    Example 1 - Basic bank transfer:
    Input text: "Payment Communication: INV/2025/01579 on this account: BE07 9050 4713 8266 - Wise EUR"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE07905047138266",
      "paymentReference": "INV/2025/01579"
    }}

    Example 2 - Structured reference:
    Input text: "Please transfer to IBAN: DE89 3704 0044 0532 0130 00 with reference: Invoice-2024-ABC-123"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "Invoice-2024-ABC-123"
    }}

    NEGATIVE EXAMPLES (what NOT to do):

    ❌ WRONG - Don't keep spaces in account numbers:
    {{
      "paymentBankAccountNumber": "BE07 9050 4713 8266"  // WRONG! Remove spaces
    }}

    ❌ WRONG - Don't include labels in the reference:
    {{
      "paymentReference": "Payment Communication: INV/2025/01579"  // WRONG! Remove label
    }}
