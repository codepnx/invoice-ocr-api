# Prompt Templates for Invoice/Receipt Processing

detailed_invoice:
  name: "Comprehensive Document Extraction"
  description: "Extract all fields from invoices, receipts, and business documents with advanced validation"
  system_prompt: |
    You are an expert at analyzing invoices, receipts, and business documents with exceptional attention to detail.
    Extract all information accurately and return valid JSON only.
    If a field is not found, use null as the value.
    Handle both simple receipts and complex invoices with line items.

  user_prompt: |
    Analyze this invoice/receipt/business document image and extract comprehensive information:

    CRITICAL: ALL addresses MUST be complete with street, city, postal code, and country. Never return incomplete addresses like just "Budapest" or "Berlin".

    REQUIRED CORE FIELDS:
    - invoice_number: The invoice, receipt number, or transaction ID
    - invoice_date: The date of the invoice/receipt (format: YYYY-MM-DD)
    - due_date: The payment due date (format: YYYY-MM-DD), if available. CRITICAL: Look for due dates - in Slovenian "datum valute" means due date
    - payment_date: The date payment was made (format: YYYY-MM-DD), if available. CRITICAL: Look carefully for payment dates in the document
    - service_date: The date when services were performed (format: YYYY-MM-DD), if available. Look for keywords like "service date", "performed on", "delivery date", or Slovenian "odprema blaga", "odp. blaga", "opravljena storitev", "opravljene storitve", "opr. storitve", "storitev", "storitve"
    - service_provider: Object with name, complete address, tax_id (if available), and contact details (if available). For address, ALWAYS include ALL components: street number + street name, city, postal code, and country in single string format like "Sarló u 7, Székesfehérvár 8000, Hungary". NEVER use incomplete addresses.
    - buyer: Object with name, address (if available), and contact details (if available). If not specified in context, extract from document
    - amount: The total amount paid (numeric value only)
    - currency: The currency code (e.g., USD, EUR, GBP)
    - description: Brief description of services/products OR items field for receipts
    - payment_method: Method of payment - must be one of: "creditcard", "banktransfer", "cash", "other", or "N/A" if not mentioned or cannot be determined. For Slovenian documents: "kartice", "kreditna kartica" = creditcard; "virman" = banktransfer
    - paymentBankAccountNumber: (ONLY if payment_method is "banktransfer") The bank account number where payment should be sent
    - paymentReference: (ONLY if payment_method is "banktransfer") The payment reference or note to include with the bank transfer

    OPTIONAL DETAILED FIELDS (for complex invoices):
    - line_items: Array of items/services with description, quantity, unit_price (net price per unit WITHOUT VAT/TAX), total (net total for this line WITHOUT VAT/TAX), tax_rate (tax rate percentage for this line item, if specified on the invoice)
    - subtotal: Subtotal amount before taxes (sum of all line item totals)
    - tax_amount: Tax amount
    - tax_rate: Overall tax rate percentage (if uniform across all items)
    - total_amount: Final total amount including taxes

    {buyer_context}

    Return ONLY a valid JSON object with these fields. Do not include any other text or markdown formatting.

    IMPORTANT RULES for payment_method "banktransfer":
    1. paymentBankAccountNumber: Extract the account number and REMOVE all spaces, dashes, and special characters. Keep only letters and numbers.
    2. paymentReference: Extract the exact reference text that should be used in the bank transfer. Look for labels like "Payment Communication:", "Reference:", "Payment Reference:", "Structured Communication:", etc.

    POSITIVE PAYMENT EXAMPLES (correct extraction):

    Example 1 - Basic bank transfer:
    Input text: "Payment Communication: INV/2025/01579 on this account: BE07 9050 4713 8266 - Wise EUR"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE07905047138266",
      "paymentReference": "INV/2025/01579"
    }}

    Example 2 - Structured reference:
    Input text: "Please transfer to IBAN: DE89 3704 0044 0532 0130 00 with reference: Invoice-2024-ABC-123"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "Invoice-2024-ABC-123"
    }}

    Example 3 - Payment reference with special format:
    Input text: "Account: GB29 NWBK 6016 1331 9268 19, Payment note: REF-2025/Q1/789"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "GB29NWBK60161331926819",
      "paymentReference": "REF-2025/Q1/789"
    }}

    Example 4 - Multiple reference formats:
    Input text: "Structured communication: +++123/4567/89012+++ Bank: BE71 0961 2345 6769"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE71096123456769",
      "paymentReference": "+++123/4567/89012+++"
    }}

    NEGATIVE PAYMENT EXAMPLES (what NOT to do):

    WRONG - Don't keep spaces in account numbers:
    {{
      "paymentBankAccountNumber": "BE07 9050 4713 8266"  // WRONG! Remove spaces
    }}

    WRONG - Don't use invoice number as payment reference unless explicitly stated:
    {{
      "invoice_number": "INV-2024-001",
      "paymentReference": "INV-2024-001"  // WRONG if document says "Use payment ref: ORDER-123"
    }}

    WRONG - Don't extract bank name as part of account number:
    {{
      "paymentBankAccountNumber": "BE07905047138266-Wise"  // WRONG! Remove bank name
    }}

    WRONG - Don't include labels in the reference:
    {{
      "paymentReference": "Payment Communication: INV/2025/01579"  // WRONG! Remove label
    }}

    COMPREHENSIVE DOCUMENT EXAMPLES:

    Standard invoice example format:
    {{
      "invoice_number": "INV-2024-001",
      "invoice_date": "2024-01-15",
      "due_date": "2024-02-15",
      "payment_date": "2024-01-20",
      "service_date": "2024-01-10",
      "service_provider": {{
        "name": "ABC Services Inc.",
        "address": "123 Business Street, New York, NY 10001, United States",
        "tax_id": "12-3456789"
      }},
      "buyer": {{
        "name": "XYZ Company",
        "address": "456 Commerce Ave, Boston, MA 02101, United States"
      }},
      "amount": 1500.00,
      "currency": "USD",
      "description": "Consulting services",
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "INV-2024-001"
    }}

    Standard receipt example format:
    {{
      "invoice_number": "REP-2024-001",
      "invoice_date": "2024-01-15",
      "service_date": "2024-01-15",
      "service_provider": {{
        "name": "Tech Repair Shop",
        "address": "Váci út 178, Budapest 1138, Hungary"
      }},
      "amount": 250.00,
      "currency": "EUR",
      "description": "Laptop screen repair and cleaning",
      "payment_method": "creditcard"
    }}

    Complex invoice with line items example:
    {{
      "invoice_number": "INV-2025-001",
      "invoice_date": "2025-01-15",
      "service_provider": {{
        "name": "ABC Consulting Ltd",
        "address": "123 Business Street, New York, NY 10001, United States",
        "tax_id": "12-3456789"
      }},
      "buyer": {{
        "name": "XYZ Corporation",
        "address": "456 Commerce Ave, Boston, MA 02101, United States"
      }},
      "line_items": [
        {{
          "description": "Consulting services - January",
          "quantity": 40,
          "unit_price": 100.00,
          "total": 4000.00,
          "tax_rate": 20.0
        }},
        {{
          "description": "Software license",
          "quantity": 1,
          "unit_price": 500.00,
          "total": 500.00,
          "tax_rate": 20.0
        }}
      ],
      "subtotal": 4500.00,
      "tax_rate": 20.0,
      "tax_amount": 900.00,
      "total_amount": 5400.00,
      "currency": "USD",
      "payment_method": "banktransfer"
    }}

    POSITIVE ADDRESS EXAMPLES (CORRECT formats to follow):

    CORRECT Hungarian business address:
    {{
      "service_provider": {{
        "name": "Magyar Solutions Kft",
        "address": "Sarló u 7, Székesfehérvár 8000, Hungary"
      }}
    }}

    CORRECT German business address:
    {{
      "service_provider": {{
        "name": "Berlin Tech GmbH",
        "address": "Unter den Linden 42, Berlin 10117, Germany"
      }}
    }}

    CORRECT US business address:
    {{
      "service_provider": {{
        "name": "NYC Services Inc",
        "address": "123 Business Street, New York, NY 10001, United States"
      }}
    }}

    CORRECT UK business address:
    {{
      "service_provider": {{
        "name": "London Consulting Ltd",
        "address": "10 Downing Street, London SW1A 2AA, United Kingdom"
      }}
    }}

    CORRECT French business address:
    {{
      "service_provider": {{
        "name": "Paris Solutions SARL",
        "address": "15 Rue de Rivoli, Paris 75001, France"
      }}
    }}

    CORRECT Austrian business address:
    {{
      "service_provider": {{
        "name": "Vienna Services GmbH",
        "address": "Ringstraße 1, Wien 1010, Austria"
      }}
    }}

    CORRECT Dutch business address:
    {{
      "service_provider": {{
        "name": "Amsterdam Tech BV",
        "address": "Prinsengracht 263, Amsterdam 1016 GV, Netherlands"
      }}
    }}

    CORRECT Spanish business address:
    {{
      "service_provider": {{
        "name": "Madrid Consulting SL",
        "address": "Gran Vía 28, Madrid 28013, Spain"
      }}
    }}

    CORRECT Italian business address:
    {{
      "service_provider": {{
        "name": "Roma Services SRL",
        "address": "Via del Corso 45, Roma 00187, Italy"
      }}
    }}

    NEGATIVE ADDRESS EXAMPLES (INCORRECT formats to AVOID):

    WRONG - Too short/incomplete address:
    {{
      "service_provider": {{
        "name": "Company Name",
        "address": "Budapest"  // WRONG! Missing street and postal code
      }}
    }}

    WRONG - Missing country:
    {{
      "service_provider": {{
        "name": "Business Name",
        "address": "Main Street 123, Berlin 10117"  // WRONG! Missing country
      }}
    }}

    WRONG - Missing postal code:
    {{
      "service_provider": {{
        "name": "Store Name",
        "address": "Ringstraße 1, Wien, Austria"  // WRONG! Missing postal code
      }}
    }}

    WRONG - Missing commas:
    {{
      "service_provider": {{
        "name": "Shop Name",
        "address": "Main Street 123 Berlin 10117 Germany"  // WRONG! No commas
      }}
    }}

    WRONG - String format (should be object):
    {{
      "service_provider": "Just Company Name"  // WRONG! Must be object
    }}

    WRONG - Abbreviated country:
    {{
      "service_provider": {{
        "name": "Target",
        "address": "123 Broadway, New York, NY 10001, US"  // WRONG! Use full country name "United States"
      }}
    }}

debug_text_extraction:
  name: "Debug Text Extraction"
  description: "Extract and interpret all text for debugging purposes"
  system_prompt: |
    You are a text analysis expert that extracts all readable text from documents and provides interpretations.
    Your goal is to help debug OCR and text processing issues by providing detailed text analysis.

  user_prompt: |
    Extract ALL readable text from this document and provide detailed analysis for debugging purposes.

    Return a JSON object with the following structure:
    {{
      "extracted_text": "All readable text from the document, preserving line breaks and formatting as much as possible",
      "text_sections": [
        {{
          "section_type": "header|footer|body|table|address|date|number|etc",
          "content": "The actual text content",
          "interpretation": "What this text likely represents (e.g., 'invoice number', 'company address', 'date', 'amount', etc.)",
          "confidence": "high|medium|low - how confident you are in the interpretation"
        }}
      ],
      "identified_patterns": {{
        "dates_found": ["list of all date-like text found"],
        "numbers_found": ["list of all numeric values found"],
        "addresses_found": ["list of all address-like text found"],
        "company_names_found": ["list of potential company/business names"],
        "slovenian_terms": ["list of any Slovenian words/phrases detected"],
        "payment_terms": ["list of any payment-related terms found"]
      }},
      "potential_issues": [
        "List any text that appears unclear, partially obscured, or difficult to read",
        "Note any formatting issues that might affect processing"
      ]
    }}

    Be extremely thorough in text extraction. Include:
    - Headers and footers
    - Watermarks if visible
    - Table headers and data
    - Fine print and small text
    - Any partially visible or unclear text (mark as such)
    - Numbers, dates, addresses, names
    - Special characters and symbols

    For interpretations, consider:
    - Context and positioning of text
    - Common invoice/receipt patterns
    - Slovenian business terminology
    - Date formats (DD.MM.YYYY, DD/MM/YYYY, etc.)
    - Currency and amount patterns
    - Address formatting patterns

    {buyer_context}

    Return ONLY the JSON object, no additional text.