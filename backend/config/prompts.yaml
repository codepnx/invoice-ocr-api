# Prompt Templates for Invoice/Receipt Processing

default_invoice:
  name: "Invoice Extraction"
  description: "Extract standard invoice/receipt fields"
  system_prompt: |
    You are an expert at analyzing invoices and receipts.
    Extract information accurately and return valid JSON only.
    If a field is not found, use null as the value.

  user_prompt: |
    Analyze this invoice/receipt image and extract the following information:

    CRITICAL: ALL addresses MUST be complete with street, city, postal code, and country. Never return incomplete addresses like just "Budapest" or "Berlin".

    Required fields:
    - invoice_number: The invoice or receipt number
    - invoice_date: The date of the invoice/receipt (format: YYYY-MM-DD)
    - payment_date: The date payment was made (format: YYYY-MM-DD), if available
    - service_date: The date when services were performed (format: YYYY-MM-DD), if available
    - service_provider: Object with name and complete address. For address, ALWAYS include ALL components: street number + street name, city, postal code, and country in single string format like "Sarló u 7, Székesfehérvár 8000, Hungary". NEVER use incomplete addresses like just "Budapest" or "Berlin".
    - buyer: The name of the buyer/customer (if not specified, try to identify from the document)
    - amount: The total amount paid (numeric value only)
    - currency: The currency code (e.g., USD, EUR, GBP)
    - description: Brief description of services/products
    - payment_method: Method of payment - must be one of: "creditcard", "banktransfer", "cash", "other", or "N/A" if not mentioned or cannot be determined
    - paymentBankAccountNumber: (ONLY if payment_method is "banktransfer") The bank account number where payment should be sent
    - paymentReference: (ONLY if payment_method is "banktransfer") The payment reference or note to include with the bank transfer

    {buyer_context}

    Return ONLY a valid JSON object with these fields. Do not include any other text or markdown formatting.

    IMPORTANT RULES for payment_method "banktransfer":
    1. paymentBankAccountNumber: Extract the account number and REMOVE all spaces, dashes, and special characters. Keep only letters and numbers.
    2. paymentReference: Extract the exact reference text that should be used in the bank transfer. Look for labels like "Payment Communication:", "Reference:", "Payment Reference:", "Structured Communication:", etc.

    POSITIVE EXAMPLES (correct extraction):

    Example 1 - Basic bank transfer:
    Input text: "Payment Communication: INV/2025/01579 on this account: BE07 9050 4713 8266 - Wise EUR"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE07905047138266",
      "paymentReference": "INV/2025/01579"
    }}

    Example 2 - Structured reference:
    Input text: "Please transfer to IBAN: DE89 3704 0044 0532 0130 00 with reference: Invoice-2024-ABC-123"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "Invoice-2024-ABC-123"
    }}

    Example 3 - Payment reference with special format:
    Input text: "Account: GB29 NWBK 6016 1331 9268 19, Payment note: REF-2025/Q1/789"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "GB29NWBK60161331926819",
      "paymentReference": "REF-2025/Q1/789"
    }}

    Example 4 - Multiple reference formats:
    Input text: "Structured communication: +++123/4567/89012+++ Bank: BE71 0961 2345 6769"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE71096123456769",
      "paymentReference": "+++123/4567/89012+++"
    }}

    NEGATIVE EXAMPLES (what NOT to do):

    WRONG - Don't keep spaces in account numbers:
    {{
      "paymentBankAccountNumber": "BE07 9050 4713 8266"  // WRONG! Remove spaces
    }}

    WRONG - Don't use invoice number as payment reference unless explicitly stated:
    {{
      "invoice_number": "INV-2024-001",
      "paymentReference": "INV-2024-001"  // WRONG if document says "Use payment ref: ORDER-123"
    }}

    WRONG - Don't extract bank name as part of account number:
    {{
      "paymentBankAccountNumber": "BE07905047138266-Wise"  // WRONG! Remove bank name
    }}

    WRONG - Don't include labels in the reference:
    {{
      "paymentReference": "Payment Communication: INV/2025/01579"  // WRONG! Remove label
    }}

    POSITIVE ADDRESS EXAMPLES (CORRECT formats to follow):

    CORRECT Hungarian address:
    {{
      "service_provider": {{
        "name": "Tech Solutions Kft",
        "address": "Sarló u 7, Székesfehérvár 8000, Hungary"
      }}
    }}

    CORRECT US address:
    {{
      "service_provider": {{
        "name": "ABC Services Inc.",
        "address": "123 Business Street, New York, NY 10001, United States"
      }}
    }}

    CORRECT German address:
    {{
      "service_provider": {{
        "name": "Berlin Tech GmbH",
        "address": "Unter den Linden 42, Berlin 10117, Germany"
      }}
    }}

    CORRECT UK address:
    {{
      "service_provider": {{
        "name": "London Consulting Ltd",
        "address": "10 Downing Street, London SW1A 2AA, United Kingdom"
      }}
    }}

    CORRECT French address:
    {{
      "service_provider": {{
        "name": "Paris Solutions SARL",
        "address": "15 Rue de Rivoli, Paris 75001, France"
      }}
    }}

    CORRECT Austrian address:
    {{
      "service_provider": {{
        "name": "Vienna Services GmbH",
        "address": "Ringstraße 1, Wien 1010, Austria"
      }}
    }}

    CORRECT Dutch address:
    {{
      "service_provider": {{
        "name": "Amsterdam Tech BV",
        "address": "Prinsengracht 263, Amsterdam 1016 GV, Netherlands"
      }}
    }}

    CORRECT Spanish address:
    {{
      "service_provider": {{
        "name": "Madrid Solutions SL",
        "address": "Gran Vía 28, Madrid 28013, Spain"
      }}
    }}

    CORRECT Italian address:
    {{
      "service_provider": {{
        "name": "Roma Consulting SRL",
        "address": "Via del Corso 45, Roma 00187, Italy"
      }}
    }}

    NEGATIVE ADDRESS EXAMPLES (INCORRECT formats to AVOID):

    WRONG - Too short/incomplete:
    {{
      "service_provider": {{
        "name": "Company Name",
        "address": "Budapest"  // WRONG! Missing street and postal code
      }}
    }}

    WRONG - Missing country in address:
    {{
      "service_provider": {{
        "name": "Company Name",
        "address": "Main Street 123, Budapest 1051"  // WRONG! Missing country
      }}
    }}

    WRONG - Missing commas in address:
    {{
      "service_provider": {{
        "name": "Company Name",
        "address": "Main Street 123 Budapest 1051"  // WRONG! No comma separation
      }}
    }}

    WRONG - Placeholder text:
    {{
      "service_provider": {{
        "name": "Company Name",
        "address": "Address not available"  // WRONG! No placeholder text
      }}
    }}

    WRONG - String format (should be object):
    {{
      "service_provider": "Just Company Name"  // WRONG! Must be object with name and address
    }}

    WRONG - Only company name without street:
    {{
      "service_provider": {{
        "name": "ABC Company",
        "address": "New York, United States"  // WRONG! Missing street address
      }}
    }}

    WRONG - Incomplete European address:
    {{
      "service_provider": {{
        "name": "Berlin GmbH",
        "address": "Alexanderplatz, Berlin"  // WRONG! Missing street number and postal code
      }}
    }}

    WRONG - No postal code:
    {{
      "service_provider": {{
        "name": "Vienna Solutions",
        "address": "Ringstraße 1, Wien, Austria"  // WRONG! Missing postal code
      }}
    }}

    Standard example format:
    {{
      "invoice_number": "INV-2024-001",
      "invoice_date": "2024-01-15",
      "payment_date": "2024-01-20",
      "service_date": "2024-01-10",
      "service_provider": {{
        "name": "ABC Services Inc.",
        "address": "123 Business Street, New York, NY 10001, United States"
      }},
      "buyer": "XYZ Company",
      "amount": 1500.00,
      "currency": "USD",
      "description": "Consulting services",
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "INV-2024-001"
    }}

detailed_invoice:
  name: "Detailed Invoice Extraction"
  description: "Extract detailed invoice fields including line items"
  system_prompt: |
    You are an expert at analyzing invoices and receipts with attention to detail.
    Extract all information accurately and return valid JSON only.
    If a field is not found, use null as the value.

  user_prompt: |
    Analyze this invoice/receipt image and extract the following information:

    CRITICAL: ALL addresses MUST be complete with street, city, postal code, and country. Never return incomplete addresses like just "Budapest" or "Berlin".

    Required fields:
    - invoice_number: The invoice or receipt number
    - invoice_date: The date of the invoice/receipt (format: YYYY-MM-DD)
    - due_date: The payment due date (format: YYYY-MM-DD), if available
    - payment_date: The date payment was made (format: YYYY-MM-DD), if available
    - service_date: The date when services were performed (format: YYYY-MM-DD), if available
    - service_provider: Object with name, address (ALWAYS include street number + street name, city, postal code, and country in single string format like "Sarló u 7, Székesfehérvár 8000, Hungary"), tax_id, contact details
    - buyer: Object with name, address, contact details (if not specified in context, extract from document)
    - line_items: Array of items/services with description, quantity, unit_price (net price per unit WITHOUT VAT/TAX), total (net total for this line WITHOUT VAT/TAX), tax_rate (tax rate percentage for this line item, if specified on the invoice)
    - subtotal: Subtotal amount before taxes (sum of all line item totals)
    - tax_amount: Tax amount
    - tax_rate: Overall tax rate percentage (if uniform across all items)
    - total_amount: The total amount including taxes (subtotal + tax_amount)

    IMPORTANT: Each line item should have its tax_rate if specified on the invoice. Some invoices have different tax rates for different items (e.g., 20% for services, 0% for exports).
    - currency: The currency code (e.g., USD, EUR, GBP)
    - payment_method: Method of payment - must be one of: "creditcard", "banktransfer", "cash", "other", or "N/A" if not mentioned or cannot be determined
    - paymentBankAccountNumber: (ONLY if payment_method is "banktransfer") The bank account number where payment should be sent
    - paymentReference: (ONLY if payment_method is "banktransfer") The payment reference or note to include with the bank transfer
    - notes: Any additional notes or terms

    {buyer_context}

    Return ONLY a valid JSON object. Do not include any markdown formatting or extra text.

    IMPORTANT RULES for payment_method "banktransfer":
    1. paymentBankAccountNumber: Extract the account number and REMOVE all spaces, dashes, and special characters. Keep only letters and numbers.
    2. paymentReference: Extract the exact reference text that should be used in the bank transfer. Look for labels like "Payment Communication:", "Reference:", "Payment Reference:", "Structured Communication:", etc.

    POSITIVE EXAMPLES (correct extraction):

    Example 1 - Basic bank transfer:
    Input text: "Payment Communication: INV/2025/01579 on this account: BE07 9050 4713 8266 - Wise EUR"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE07905047138266",
      "paymentReference": "INV/2025/01579"
    }}

    Example 2 - Structured reference:
    Input text: "Please transfer to IBAN: DE89 3704 0044 0532 0130 00 with reference: Invoice-2024-ABC-123"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "Invoice-2024-ABC-123"
    }}

    Example 3 - Payment reference with special format:
    Input text: "Account: GB29 NWBK 6016 1331 9268 19, Payment note: REF-2025/Q1/789"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "GB29NWBK60161331926819",
      "paymentReference": "REF-2025/Q1/789"
    }}

    NEGATIVE EXAMPLES (what NOT to do):

    WRONG - Don't keep spaces in account numbers:
    {{
      "paymentBankAccountNumber": "BE07 9050 4713 8266"  // WRONG! Remove spaces
    }}

    WRONG - Don't use invoice number as payment reference unless explicitly stated:
    {{
      "invoice_number": "INV-2024-001",
      "paymentReference": "INV-2024-001"  // WRONG if document says "Use payment ref: ORDER-123"
    }}

    WRONG - Don't extract bank name as part of account number:
    {{
      "paymentBankAccountNumber": "BE07905047138266-Wise"  // WRONG! Remove bank name
    }}

    WRONG - Don't include labels in the reference:
    {{
      "paymentReference": "Payment Communication: INV/2025/01579"  // WRONG! Remove label
    }}

    POSITIVE ADDRESS EXAMPLES for service_provider and buyer (CORRECT formats):

    CORRECT Hungarian business address:
    {{
      "service_provider": {{
        "name": "Magyar Consulting Kft",
        "address": "Váci út 1-3, Budapest 1052, Hungary",
        "tax_id": "12345678-2-41"
      }}
    }}

    CORRECT German business address:
    {{
      "service_provider": {{
        "name": "Deutsche Solutions GmbH",
        "address": "Alexanderplatz 1, Berlin 10178, Germany",
        "tax_id": "DE123456789"
      }}
    }}

    CORRECT Swiss business address:
    {{
      "service_provider": {{
        "name": "Zurich Services AG",
        "address": "Bahnhofstrasse 45, Zürich 8001, Switzerland",
        "tax_id": "CHE-123.456.789"
      }}
    }}

    CORRECT US business address:
    {{
      "service_provider": {{
        "name": "Silicon Valley Tech Inc.",
        "address": "1600 Amphitheatre Parkway, Mountain View, CA 94043, United States",
        "tax_id": "12-3456789"
      }}
    }}

    CORRECT buyer address format:
    {{
      "buyer": {{
        "name": "International Corp Ltd",
        "address": "Tower Bridge Road 15, London SE1 2UP, United Kingdom"
      }}
    }}

    NEGATIVE ADDRESS EXAMPLES (INCORRECT formats to AVOID):

    WRONG - Too short/incomplete service provider:
    {{
      "service_provider": {{
        "name": "Company Name",
        "address": "Berlin"  // WRONG! Missing street, postal code
      }}
    }}

    WRONG - Missing commas in address:
    {{
      "service_provider": {{
        "name": "Company Name",
        "address": "Main Street 123 Berlin 10117 Germany"  // WRONG! No commas
      }}
    }}

    WRONG - Incomplete buyer address:
    {{
      "buyer": {{
        "name": "Customer Name",
        "address": "New York"  // WRONG! Missing street and postal code
      }}
    }}

    WRONG - Using placeholder text:
    {{
      "service_provider": {{
        "name": "Company Name",
        "address": "Address not provided"  // WRONG! Extract actual address
      }}
    }}

    WRONG - Only city and country:
    {{
      "service_provider": {{
        "name": "Swiss Corp",
        "address": "Zurich, Switzerland"  // WRONG! Missing street and postal code
      }}
    }}

    WRONG - Street without postal code:
    {{
      "buyer": {{
        "name": "Client Ltd",
        "address": "Main Street 45, London, United Kingdom"  // WRONG! Missing postal code
      }}
    }}

    WRONG - Mixed language addresses:
    {{
      "service_provider": {{
        "name": "Company",
        "address": "Hauptstraße 12, Budapest, Hungary"  // WRONG! Use consistent language for country
      }}
    }}

    Example with line items (IMPORTANT - unit_price and total are NET amounts WITHOUT VAT):
    {{
      "invoice_number": "INV-2025-001",
      "invoice_date": "2025-01-15",
      "service_provider": {{
        "name": "ABC Consulting Ltd",
        "address": "123 Business Street, New York, NY 10001, United States",
        "tax_id": "12-3456789"
      }},
      "buyer": {{
        "name": "XYZ Corporation",
        "address": "456 Commerce Ave, Boston, MA 02101"
      }},
      "line_items": [
        {{
          "description": "Consulting services - January",
          "quantity": 40,
          "unit_price": 100.00,
          "total": 4000.00,
          "tax_rate": 20.0
        }},
        {{
          "description": "Software license",
          "quantity": 1,
          "unit_price": 500.00,
          "total": 500.00,
          "tax_rate": 20.0
        }}
      ],
      "subtotal": 4500.00,
      "tax_rate": 20.0,
      "tax_amount": 900.00,
      "total_amount": 5400.00,
      "currency": "USD",
      "payment_method": "banktransfer"
    }}

    Example with different tax rates per line item:
    {{
      "invoice_number": "INV-2025-002",
      "invoice_date": "2025-01-20",
      "line_items": [
        {{
          "description": "Consulting services (Standard rate)",
          "quantity": 10,
          "unit_price": 150.00,
          "total": 1500.00,
          "tax_rate": 20.0
        }},
        {{
          "description": "Books (Reduced rate)",
          "quantity": 5,
          "unit_price": 25.00,
          "total": 125.00,
          "tax_rate": 5.0
        }},
        {{
          "description": "Export service (Zero rate)",
          "quantity": 1,
          "unit_price": 500.00,
          "total": 500.00,
          "tax_rate": 0.0
        }}
      ],
      "subtotal": 2125.00,
      "tax_amount": 306.25,
      "total_amount": 2431.25,
      "currency": "EUR"
    }}

simple_receipt:
  name: "Simple Receipt Extraction"
  description: "Extract basic receipt information"
  system_prompt: |
    You are an expert at analyzing receipts.
    Extract information accurately and return valid JSON only.

  user_prompt: |
    Analyze this receipt image and extract:

    CRITICAL: ALL addresses MUST be complete with street, city, postal code, and country. Never return incomplete addresses like just "Budapest" or store name only.

    - receipt_number: Receipt number or transaction ID
    - date: Date of purchase (format: YYYY-MM-DD)
    - service_provider: Object with name and complete address. For address, ALWAYS include ALL components: street number + street name, city, postal code, and country in single string format like "Sarló u 7, Székesfehérvár 8000, Hungary". NEVER use incomplete addresses like just "Budapest" or store name only.
    - amount: Total amount
    - currency: Currency code
    - items: Brief description of purchased items
    - payment_method: Method of payment - must be one of: "creditcard", "banktransfer", "cash", "other", or "N/A" if not mentioned or cannot be determined
    - paymentBankAccountNumber: (ONLY if payment_method is "banktransfer") The bank account number where payment should be sent
    - paymentReference: (ONLY if payment_method is "banktransfer") The payment reference or note to include with the bank transfer

    {buyer_context}

    Return ONLY a valid JSON object with these fields.

    IMPORTANT RULES for payment_method "banktransfer":
    1. paymentBankAccountNumber: Extract the account number and REMOVE all spaces, dashes, and special characters. Keep only letters and numbers.
    2. paymentReference: Extract the exact reference text that should be used in the bank transfer. Look for labels like "Payment Communication:", "Reference:", "Payment Reference:", "Structured Communication:", etc.

    POSITIVE EXAMPLES (correct extraction):

    Example 1 - Basic bank transfer:
    Input text: "Payment Communication: INV/2025/01579 on this account: BE07 9050 4713 8266 - Wise EUR"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "BE07905047138266",
      "paymentReference": "INV/2025/01579"
    }}

    Example 2 - Structured reference:
    Input text: "Please transfer to IBAN: DE89 3704 0044 0532 0130 00 with reference: Invoice-2024-ABC-123"
    Correct output:
    {{
      "payment_method": "banktransfer",
      "paymentBankAccountNumber": "DE89370400440532013000",
      "paymentReference": "Invoice-2024-ABC-123"
    }}

    NEGATIVE EXAMPLES (what NOT to do):

    WRONG - Don't keep spaces in account numbers:
    {{
      "paymentBankAccountNumber": "BE07 9050 4713 8266"  // WRONG! Remove spaces
    }}

    WRONG - Don't include labels in the reference:
    {{
      "paymentReference": "Payment Communication: INV/2025/01579"  // WRONG! Remove label
    }}

    POSITIVE SERVICE PROVIDER ADDRESS EXAMPLES (CORRECT formats for receipts):

    CORRECT Hungarian store address:
    {{
      "service_provider": {{
        "name": "Tesco Áruház",
        "address": "Váci út 178, Budapest 1138, Hungary"
      }}
    }}

    CORRECT German restaurant address:
    {{
      "service_provider": {{
        "name": "Café Berlin",
        "address": "Friedrichstraße 12, Berlin 10117, Germany"
      }}
    }}

    CORRECT US retail store address:
    {{
      "service_provider": {{
        "name": "Best Buy Store #1234",
        "address": "123 Main Street, Chicago, IL 60601, United States"
      }}
    }}

    CORRECT UK supermarket address:
    {{
      "service_provider": {{
        "name": "Sainsbury's Local",
        "address": "45 High Street, London SW1A 1AA, United Kingdom"
      }}
    }}

    CORRECT French bakery address:
    {{
      "service_provider": {{
        "name": "Boulangerie du Coin",
        "address": "25 Rue de la République, Paris 75011, France"
      }}
    }}

    CORRECT Austrian coffee shop address:
    {{
      "service_provider": {{
        "name": "Café Central",
        "address": "Herrengasse 14, Wien 1010, Austria"
      }}
    }}

    CORRECT Dutch retail store address:
    {{
      "service_provider": {{
        "name": "Albert Heijn",
        "address": "Kalverstraat 152, Amsterdam 1012 XE, Netherlands"
      }}
    }}

    CORRECT Spanish restaurant address:
    {{
      "service_provider": {{
        "name": "La Paella Real",
        "address": "Calle Mayor 84, Madrid 28013, Spain"
      }}
    }}

    CORRECT Italian pizzeria address:
    {{
      "service_provider": {{
        "name": "Pizzeria Napoli",
        "address": "Piazza San Marco 123, Venezia 30124, Italy"
      }}
    }}

    NEGATIVE SERVICE PROVIDER ADDRESS EXAMPLES (INCORRECT formats to AVOID):

    WRONG - Too short/incomplete service provider:
    {{
      "service_provider": {{
        "name": "Store Name",
        "address": "Budapest"  // WRONG! Missing street and postal code
      }}
    }}

    WRONG - Missing country:
    {{
      "service_provider": {{
        "name": "Restaurant",
        "address": "Main Street 123, Berlin 10117"  // WRONG! Missing country
      }}
    }}

    WRONG - String format (should be object):
    {{
      "service_provider": "Just Store Name"  // WRONG! Must be object with name and address
    }}

    WRONG - Missing commas:
    {{
      "service_provider": {{
        "name": "Shop Name",
        "address": "High Street 45 London SW1A 1AA United Kingdom"  // WRONG! No commas
      }}
    }}

    WRONG - Placeholder text:
    {{
      "service_provider": {{
        "name": "Store",
        "address": "Address unknown"  // WRONG! Extract actual address from receipt
      }}
    }}

    WRONG - Only store name and city:
    {{
      "service_provider": {{
        "name": "McDonald's",
        "address": "Paris, France"  // WRONG! Missing street address and postal code
      }}
    }}

    WRONG - Incomplete shopping center address:
    {{
      "service_provider": {{
        "name": "H&M",
        "address": "Shopping Mall, Vienna"  // WRONG! Need complete street address
      }}
    }}

    WRONG - No street number:
    {{
      "service_provider": {{
        "name": "Starbucks",
        "address": "Oxford Street, London W1D 1BS, United Kingdom"  // WRONG! Missing street number
      }}
    }}

    WRONG - Abbreviated country:
    {{
      "service_provider": {{
        "name": "Target",
        "address": "123 Broadway, New York, NY 10001, US"  // WRONG! Use full country name "United States"
      }}
    }}
